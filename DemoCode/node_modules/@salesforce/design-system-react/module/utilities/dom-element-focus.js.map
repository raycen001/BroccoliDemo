{"version":3,"sources":["../../.tmp-es/utilities/dom-element-focus.js"],"names":["findTabbableElement","KEYS","canUseDOM","ancestor","focusLaterElement","handleScopedKeyDown","event","keyCode","TAB","tabbableElements","finalTabbable","shiftKey","length","leavingFinalTabbable","document","activeElement","preventDefault","target","focus","ElementFocus","focusAncestor","isPortal","offset","window","pageYOffset","preventScroll","scrollTo","pageXOffset","hasOrAncestorHasFocus","contains","returnFocusToStoredElement","e","console","warn","setupScopedFocus","ancestorElement","addEventListener","storeActiveElement","teardownScopedFocus","removeEventListener"],"mappings":"AAAA,OAAOA,mBAAP,MAAgC,YAAhC;AACA,OAAOC,IAAP,MAAiB,YAAjB;AACA,SAASC,SAAT,QAA0B,yBAA1B;AAEA,IAAIC,QAAQ,GAAG,IAAf;AACA,IAAIC,iBAAiB,GAAG,IAAxB;;AAEA,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,KAAD,EAAW;AACtC,MAAI,CAACJ,SAAD,IAAc,CAACC,QAAf,IAA2BG,KAAK,CAACC,OAAN,KAAkBN,IAAI,CAACO,GAAtD,EAA2D;AAC1D;AACA;;AACD,MAAMC,gBAAgB,GAAGT,mBAAmB,CAACG,QAAD,CAA5C;AACA,MAAMO,aAAa,GAClBD,gBAAgB,CAACH,KAAK,CAACK,QAAN,GAAiB,CAAjB,GAAqBF,gBAAgB,CAACG,MAAjB,GAA0B,CAAhD,CADjB;AAEA,MAAMC,oBAAoB,GACzBH,aAAa,KAAKI,QAAQ,CAACC,aAA3B,IACA;AACAZ,EAAAA,QAAQ,KAAKW,QAAQ,CAACC,aAHvB;AAIA,MAAI,CAACF,oBAAL,EAA2B;AAC3BP,EAAAA,KAAK,CAACU,cAAN;AACA,MAAMC,MAAM,GACXR,gBAAgB,CAACH,KAAK,CAACK,QAAN,GAAiBF,gBAAgB,CAACG,MAAjB,GAA0B,CAA3C,GAA+C,CAAhD,CADjB;AAEAK,EAAAA,MAAM,CAACC,KAAP;AACA,CAhBD,C,CAkBA;;;AAEA,IAAMC,YAAY,GAAG;AACpBC,EAAAA,aAAa,EAAE,6BAAkB;AAAA,QAAfC,QAAe,QAAfA,QAAe;;AAChC,QAAInB,SAAJ,EAAe;AACd;AACA,UAAImB,QAAJ,EAAc;AACb,YAAMC,MAAM,GAAGC,MAAM,CAACC,WAAtB;AACArB,QAAAA,QAAQ,CAACe,KAAT,CAAe;AAAEO,UAAAA,aAAa,EAAE;AAAjB,SAAf;AACAF,QAAAA,MAAM,CAACG,QAAP,CAAgBH,MAAM,CAACI,WAAvB,EAAoCL,MAApC;AACA,OAJD,MAIO;AACNnB,QAAAA,QAAQ,CAACe,KAAT;AACA;AACD;AACD,GAZmB;AAapBU,EAAAA,qBAAqB,EAAE;AAAA,WACtB1B,SAAS,KACRY,QAAQ,CAACC,aAAT,KAA2BZ,QAA3B,IACAA,QAAQ,CAAC0B,QAAT,CAAkBf,QAAQ,CAACC,aAA3B,CAFQ,CADa;AAAA,GAbH;AAiBpBe,EAAAA,0BAA0B,EAAE,sCAAM;AACjC,QAAI5B,SAAJ,EAAe;AACd,UAAI;AACHE,QAAAA,iBAAiB,CAACc,KAAlB;AACA,OAFD,CAEE,OAAOa,CAAP,EAAU;AACX;AACAC,QAAAA,OAAO,CAACC,IAAR,wCACiC7B,iBADjC;AAGA;;AACDA,MAAAA,iBAAiB,GAAG,IAApB;AACA;AACD,GA7BmB;AA8BpB8B,EAAAA,gBAAgB,EAAE,iCAAyB;AAAA,QAAtBC,eAAsB,SAAtBA,eAAsB;AAC1ChC,IAAAA,QAAQ,GAAGgC,eAAX;AACAZ,IAAAA,MAAM,CAACa,gBAAP,CAAwB,SAAxB,EAAmC/B,mBAAnC,EAAwD,KAAxD;AACA,GAjCmB;AAkCpBgC,EAAAA,kBAAkB,EAAE,8BAAM;AACzBjC,IAAAA,iBAAiB,GAAGF,SAAS,GAAGY,QAAQ,CAACC,aAAZ,GAA4B,IAAzD;AACA,GApCmB;AAqCpBuB,EAAAA,mBAAmB,EAAE,+BAAM;AAC1BnC,IAAAA,QAAQ,GAAG,IAAX;;AACA,QAAID,SAAJ,EAAe;AACdqB,MAAAA,MAAM,CAACgB,mBAAP,CAA2B,SAA3B,EAAsClC,mBAAtC;AACA;AACD;AA1CmB,CAArB;AA6CA,eAAec,YAAf","sourcesContent":["import findTabbableElement from './tabbable';\nimport KEYS from './key-code';\nimport { canUseDOM } from './execution-environment';\n\nlet ancestor = null;\nlet focusLaterElement = null;\n\nconst handleScopedKeyDown = (event) => {\n\tif (!canUseDOM || !ancestor || event.keyCode !== KEYS.TAB) {\n\t\treturn;\n\t}\n\tconst tabbableElements = findTabbableElement(ancestor);\n\tconst finalTabbable =\n\t\ttabbableElements[event.shiftKey ? 0 : tabbableElements.length - 1];\n\tconst leavingFinalTabbable =\n\t\tfinalTabbable === document.activeElement ||\n\t\t// handle immediate shift+tab after opening with mouse\n\t\tancestor === document.activeElement;\n\tif (!leavingFinalTabbable) return;\n\tevent.preventDefault();\n\tconst target =\n\t\ttabbableElements[event.shiftKey ? tabbableElements.length - 1 : 0];\n\ttarget.focus();\n};\n\n// PUBLIC methods\n\nconst ElementFocus = {\n\tfocusAncestor: ({ isPortal }) => {\n\t\tif (canUseDOM) {\n\t\t\t// When a portal is used (that is attaching a separate React mount, such as with Popover) programatic focusing within that portal may cause the window to scroll down to the DOM insertion point at the end of `body`. The following prevents the scrolling from occuring.\n\t\t\tif (isPortal) {\n\t\t\t\tconst offset = window.pageYOffset;\n\t\t\t\tancestor.focus({ preventScroll: true });\n\t\t\t\twindow.scrollTo(window.pageXOffset, offset);\n\t\t\t} else {\n\t\t\t\tancestor.focus();\n\t\t\t}\n\t\t}\n\t},\n\thasOrAncestorHasFocus: () =>\n\t\tcanUseDOM &&\n\t\t(document.activeElement === ancestor ||\n\t\t\tancestor.contains(document.activeElement)),\n\treturnFocusToStoredElement: () => {\n\t\tif (canUseDOM) {\n\t\t\ttry {\n\t\t\t\tfocusLaterElement.focus();\n\t\t\t} catch (e) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`You tried to return focus to ${focusLaterElement} but it is not in the DOM anymore`\n\t\t\t\t);\n\t\t\t}\n\t\t\tfocusLaterElement = null;\n\t\t}\n\t},\n\tsetupScopedFocus: ({ ancestorElement }) => {\n\t\tancestor = ancestorElement;\n\t\twindow.addEventListener('keydown', handleScopedKeyDown, false);\n\t},\n\tstoreActiveElement: () => {\n\t\tfocusLaterElement = canUseDOM ? document.activeElement : null;\n\t},\n\tteardownScopedFocus: () => {\n\t\tancestor = null;\n\t\tif (canUseDOM) {\n\t\t\twindow.removeEventListener('keydown', handleScopedKeyDown);\n\t\t}\n\t},\n};\n\nexport default ElementFocus;\n"],"file":"dom-element-focus.js"}