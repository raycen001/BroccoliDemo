{"version":3,"sources":["../../../../.tmp-es/components/utilities/truncate/index.jsx"],"names":["React","PropTypes","memoize","documentDefined","document","canvas","docFragment","canvasContext","measureWidth","createElement","createDocumentFragment","appendChild","getContext","text","font","measureText","width","TextTruncate","update","props","ref","nextProps","scope","propsToRender","containerClassName","line","prefix","suffix","textTruncateChild","truncateText","wrapper","scopeWidth","getBoundingClientRect","style","window","getComputedStyle","join","setState","renderText","child","outputText","currentPos","maxTextLength","length","truncatedText","splitPos","startPos","displayLine","lastIsEng","lastSpaceIndex","ext","extraWidthDueToPrefixStyle","substr","indexOf","lastWidth","lastIndexOf","getRenderText","addEventListener","onResize","removeEventListener","overflow","state","Component","string","number","node","func"],"mappings":"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","sourcesContent":["/* Copyright (c) 2015-present, salesforce.com, inc. All rights reserved */\n/* Licensed under BSD 3-Clause - see LICENSE.txt or git.io/sfdc-license */\n\nimport React from 'react';\n\nimport PropTypes from 'prop-types';\n\nimport memoize from 'lodash.memoize';\n\nconst documentDefined = typeof document !== 'undefined';\n\nlet canvas;\nlet docFragment;\nlet canvasContext;\nlet measureWidth = () => {};\n\nif (documentDefined) {\n\tcanvas = document.createElement('canvas');\n\tdocFragment = document.createDocumentFragment();\n\tdocFragment.appendChild(canvas);\n\tcanvasContext = canvas.getContext('2d');\n\tmeasureWidth = memoize((text, font) => {\n\t\tcanvasContext.font = font;\n\t\treturn canvasContext.measureText(text).width;\n\t});\n}\n\nclass TextTruncate extends React.Component {\n\tstatic displayName = 'TextTruncate';\n\n\tstatic propTypes = {\n\t\tcontainerClassName: PropTypes.string,\n\t\tline: PropTypes.number,\n\t\tprefix: PropTypes.string,\n\t\tsuffix: PropTypes.string,\n\t\ttext: PropTypes.string,\n\t\ttextTruncateChild: PropTypes.node,\n\t\ttruncateText: PropTypes.string,\n\t\twrapper: PropTypes.func,\n\t};\n\n\tstatic defaultProps = {\n\t\tline: 1,\n\t\ttext: '',\n\t\ttruncateText: 'â€¦',\n\t};\n\n\tstate = {};\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener('resize', this.onResize, false);\n\t}\n\n\tcomponentDidUpdate(nextProps) {\n\t\tif (nextProps.text !== this.props.text) {\n\t\t\tthis.update(nextProps);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener('resize', this.onResize, false);\n\t}\n\n\tonResize = () => {\n\t\tthis.update(this.props);\n\t};\n\n\tgetRenderText = (ref, nextProps) => {\n\t\tif (!ref) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.scope = ref;\n\n\t\t// nextProps will be undefined for resize events, but will change if search or other props are changed\n\t\tlet propsToRender;\n\t\tif (nextProps) {\n\t\t\tpropsToRender = nextProps;\n\t\t} else {\n\t\t\tpropsToRender = this.props;\n\t\t}\n\n\t\tconst {\n\t\t\tcontainerClassName, // eslint-disable-line no-unused-vars\n\t\t\tline,\n\t\t\tprefix,\n\t\t\tsuffix,\n\t\t\ttext,\n\t\t\ttextTruncateChild,\n\t\t\ttruncateText,\n\t\t\twrapper,\n\t\t\t...props\n\t\t} = propsToRender;\n\n\t\tconst scopeWidth = this.scope.getBoundingClientRect().width;\n\t\tconst style = window.getComputedStyle(this.scope);\n\t\tconst font = [\n\t\t\tstyle['font-weight'],\n\t\t\tstyle['font-style'],\n\t\t\tstyle['font-size'],\n\t\t\tstyle['font-family'],\n\t\t].join(' ');\n\n\t\t// return if display:none\n\t\tif (scopeWidth === 0) {\n\t\t\tthis.setState({ renderText: null });\n\t\t\treturn;\n\t\t}\n\n\t\tlet child;\n\t\tlet outputText = text;\n\n\t\t// return if all of text can be displayed\n\t\tif (scopeWidth < measureWidth(text, font)) {\n\t\t\tlet currentPos = 1;\n\t\t\tconst maxTextLength = text.length;\n\t\t\tlet truncatedText = '';\n\t\t\tlet splitPos = 0;\n\t\t\tlet startPos = 0;\n\t\t\tlet displayLine = line;\n\t\t\tlet width = 0;\n\t\t\tlet lastIsEng = false;\n\t\t\tlet lastSpaceIndex = -1;\n\n\t\t\t// eslint-disable-next-line fp/no-loops\n\t\t\twhile (displayLine !== 0) {\n\t\t\t\tlet ext = '';\n\t\t\t\tlet extraWidthDueToPrefixStyle = 0;\n\n\t\t\t\tif (prefix && displayLine === line - 1) {\n\t\t\t\t\text += ` ${prefix}`;\n\t\t\t\t\t// MAGIC NUMBER: (width at letter-spacing of 0.25rems - width at normal) / number of letters\n\t\t\t\t\textraWidthDueToPrefixStyle = prefix.length * 0.66;\n\t\t\t\t}\n\n\t\t\t\tif (!displayLine) {\n\t\t\t\t\text += truncateText;\n\n\t\t\t\t\tif (suffix) {\n\t\t\t\t\t\text += ` ${suffix}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line fp/no-loops\n\t\t\t\twhile (currentPos <= maxTextLength) {\n\t\t\t\t\ttruncatedText = text.substr(startPos, currentPos);\n\t\t\t\t\twidth =\n\t\t\t\t\t\tmeasureWidth(truncatedText + ext, font) +\n\t\t\t\t\t\textraWidthDueToPrefixStyle;\n\n\t\t\t\t\tif (width < scopeWidth) {\n\t\t\t\t\t\tsplitPos = text.indexOf(' ', currentPos + 1);\n\t\t\t\t\t\tif (splitPos === -1) {\n\t\t\t\t\t\t\tcurrentPos += 1;\n\t\t\t\t\t\t\tlastIsEng = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlastIsEng = true;\n\t\t\t\t\t\t\tcurrentPos = splitPos;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet lastWidth = 0;\n\t\t\t\t\t\t// eslint-disable-next-line fp/no-loops\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tcurrentPos -= 1;\n\t\t\t\t\t\t\ttruncatedText = text.substr(startPos, currentPos);\n\t\t\t\t\t\t\tif (truncatedText[truncatedText.length - 1] === ' ') {\n\t\t\t\t\t\t\t\ttruncatedText = text.substr(startPos, currentPos - 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (lastIsEng) {\n\t\t\t\t\t\t\t\tlastSpaceIndex = truncatedText.lastIndexOf(' ');\n\t\t\t\t\t\t\t\tif (lastSpaceIndex > -1) {\n\t\t\t\t\t\t\t\t\tcurrentPos = lastSpaceIndex;\n\t\t\t\t\t\t\t\t\ttruncatedText = text.substr(startPos, currentPos);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twidth =\n\t\t\t\t\t\t\t\tmeasureWidth(truncatedText + ext, font) +\n\t\t\t\t\t\t\t\textraWidthDueToPrefixStyle;\n\t\t\t\t\t\t\tif (width === lastWidth) {\n\t\t\t\t\t\t\t\tcurrentPos = 0;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlastWidth = width;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} while (width >= scopeWidth);\n\t\t\t\t\t\tstartPos += currentPos;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (currentPos >= maxTextLength) {\n\t\t\t\t\tstartPos = maxTextLength;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdisplayLine -= 1; // iterate\n\t\t\t}\n\n\t\t\tif (startPos !== maxTextLength) {\n\t\t\t\toutputText = `${text.substr(0, startPos)}${truncateText} `;\n\t\t\t\tchild = textTruncateChild;\n\t\t\t}\n\t\t}\n\n\t\tlet renderText;\n\t\tif (wrapper) {\n\t\t\trenderText = wrapper(outputText, child);\n\t\t} else {\n\t\t\trenderText = (\n\t\t\t\t<div {...props}>\n\t\t\t\t\t{outputText}\n\t\t\t\t\t{child}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tthis.setState({ renderText });\n\t};\n\n\tupdate = (nextProps) => {\n\t\tthis.getRenderText(this.scope, nextProps);\n\t};\n\n\trender() {\n\t\tconst { containerClassName } = this.props;\n\n\t\t// inline style override\n\t\treturn (\n\t\t\t<div\n\t\t\t\tref={this.getRenderText}\n\t\t\t\tclassName={containerClassName}\n\t\t\t\tstyle={{ overflow: 'hidden' }}\n\t\t\t>\n\t\t\t\t{this.state.renderText}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default TextTruncate;\n"],"file":"index.js"}